<!-- HTML for custom Swagger UI login -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>API Documentation</title>
  <link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@4.5.0/swagger-ui.css" />
  <style>
    html {
      box-sizing: border-box;
      overflow: -moz-scrollbars-vertical;
      overflow-y: scroll;
    }
    
    *,
    *:before,
    *:after {
      box-sizing: inherit;
    }
    
    body {
      margin: 0;
      background: #fafafa;
    }
    
    .swagger-ui .topbar {
      background-color: #1b1b1b;
    }
    
    #login-container {
      background-color: #fff;
      padding: 20px;
      border-radius: 4px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      margin: 20px auto;
      max-width: 500px;
    }
    
    #login-container h2 {
      margin-top: 0;
      color: #3b4151;
    }
    
    #login-form {
      display: flex;
      flex-direction: column;
    }
    
    #login-form input {
      margin-bottom: 10px;
      padding: 8px;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
    }
    
    #login-form button {
      background-color: #4990e2;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    #login-form button:hover {
      background-color: #357abd;
    }
    
    #token-display {
      margin-top: 15px;
      word-break: break-all;
      display: none;
    }
    
    .token-field {
      background-color: #f0f0f0;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
    }
    
    .copy-btn {
      margin-top: 10px;
      background-color: #49cc90;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .apply-btn {
      margin-top: 10px;
      background-color: #61affe;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="login-container">
    <h2>API Authentication</h2>
    <form id="login-form">
      <input type="email" id="email" placeholder="Email" required>
      <input type="password" id="password" placeholder="Password" required>
      <button type="submit">Login</button>
    </form>
    <div id="token-display">
      <h3>Your Access Token:</h3>
      <div class="token-field" id="token-field"></div>
      <button class="copy-btn" id="copy-token">Copy Token</button>
      <button class="apply-btn" id="apply-token">Apply Token to All Requests</button>
    </div>
  </div>
  
  <div id="swagger-ui"></div>

  <script src="https://unpkg.com/swagger-ui-dist@4.5.0/swagger-ui-bundle.js"></script>
  <script src="https://unpkg.com/swagger-ui-dist@4.5.0/swagger-ui-standalone-preset.js"></script>
  <script>
    window.onload = function() {
      // Login form handling
      document.getElementById('login-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        try {
          const response = await fetch('/v1/auth/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email, password })
          });
          
          const data = await response.json();
          
          if (data.status && data.data && data.data.token) {
            // Show token
            document.getElementById('token-field').textContent = data.data.token;
            document.getElementById('token-display').style.display = 'block';
            
            // Store token in localStorage
            localStorage.setItem('api_token', data.data.token);
            
            // Auto-apply token to Swagger UI
            ui.preauthorizeApiKey("ApiKeyAuth", "Bearer " + data.data.token);
          } else {
            alert('Login failed: ' + (data.message || 'Invalid credentials'));
          }
        } catch (error) {
          console.error('Login error:', error);
          alert('Login failed. Please check console for details.');
        }
      });
      
      // Copy token button
      document.getElementById('copy-token').addEventListener('click', function() {
        const tokenField = document.getElementById('token-field');
        const range = document.createRange();
        range.selectNode(tokenField);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
        document.execCommand('copy');
        window.getSelection().removeAllRanges();
        alert('Token copied to clipboard!');
      });
      
      // Apply token button
      document.getElementById('apply-token').addEventListener('click', function() {
        const token = document.getElementById('token-field').textContent;
        ui.preauthorizeApiKey("ApiKeyAuth", "Bearer " + token);
        alert('Token applied to all requests!');
      });
      
      // Initialize Swagger UI
      const ui = SwaggerUIBundle({
        url: "/api-docs/swagger.json",
        dom_id: '#swagger-ui',
        deepLinking: true,
        presets: [
          SwaggerUIBundle.presets.apis,
          SwaggerUIStandalonePreset
        ],
        plugins: [
          SwaggerUIBundle.plugins.DownloadUrl
        ],
        layout: "StandaloneLayout",
        persistAuthorization: true
      });
      
      // Check if we have a stored token and apply it
      const storedToken = localStorage.getItem('api_token');
      if (storedToken) {
        document.getElementById('token-field').textContent = storedToken;
        document.getElementById('token-display').style.display = 'block';
        ui.preauthorizeApiKey("ApiKeyAuth", "Bearer " + storedToken);
      }
      
      window.ui = ui;
    }
  </script>
</body>
</html>